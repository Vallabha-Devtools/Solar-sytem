name: List Milestone Issues

on:
  workflow_dispatch:  # Allows you to run this manually from the GitHub UI

jobs:
  list-milestone-issues:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: List milestone issues using GraphQL
        uses: actions/github-script@v7
        with:
          script: |
            const query = `
              query($owner: String!, $name: String!, $milestone: String!) {
                repository(owner: $owner, name: $name) {
                  milestones(first: 10, query: $milestone) {
                    nodes {
                      title
                      issues(first: 10) {
                        nodes {
                          number
                          title
                          url
                          state
                        }
                      }
                    }
                  }
                }
              }
            `;

            const variables = {
              owner: context.repo.owner,
              name: context.repo.repo,
              milestone: "v1.0" 
            };

            const result = await github.graphql(query, variables);

            
            for (const milestone of result.repository.milestones.nodes) {
              console.log(`Milestone: ${milestone.title}`);
              for (const issue of milestone.issues.nodes) {
                console.log(`#${issue.number}: ${issue.title} [${issue.state}]`);
                console.log(`URL: ${issue.url}`);
              }
            }
